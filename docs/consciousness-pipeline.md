# Aenea Consciousness Processing Pipeline

## Overview

Aenea ã®æ„è­˜å‡¦ç†ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¯ã€å†…éƒ¨çš„ãªè‡ªå·±å•ã„ã‹ã‘ã‹ã‚‰ Core Beliefs ã®å½¢æˆã¾ã§ã€äººé–“ã®æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹ã‚’æ¨¡å€£ã—ãŸå¤šæ®µéšã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚

---

## ğŸ”„ Thought Cycle ã®æµã‚Œ

### Adaptive Execution (ã‚¨ãƒãƒ«ã‚®ãƒ¼é©å¿œå‹å®Ÿè¡Œ)

ã‚·ã‚¹ãƒ†ãƒ ã¯åˆ©ç”¨å¯èƒ½ãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã«å¿œã˜ã¦ã€3ã¤ã®ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¾ã™ï¼š

| Mode | Energy Threshold | Stages Executed | Purpose |
|------|------------------|-----------------|---------|
| **Critical** | < 20 | S0, S1, S5, S6, U | æœ€å°é™ã®æ€è€ƒç¶­æŒ |
| **Low** | 20-50 | S0, S1, S2, S5, S6, U | åŸºæœ¬çš„ãªæ€è€ƒå‡¦ç† |
| **Full** | > 50 | S0, S1, S2, S3, S4, S5, S6, U | å®Œå…¨ãªå“²å­¦çš„æ¢æ±‚ |

---

## ğŸ“‹ Processing Stages (è©³ç´°)

### **[S0] Internal Trigger Generation** - å†…éƒ¨ãƒˆãƒªã‚¬ãƒ¼ç”Ÿæˆ
**ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»**: 1.0
**å®Ÿè¡Œæ¡ä»¶**: å¸¸ã«å®Ÿè¡Œ

**å‡¦ç†å†…å®¹**:
1. **9ã¤ã®å“²å­¦ã‚«ãƒ†ã‚´ãƒªãƒ¼**ã‹ã‚‰è³ªå•ã‚’ç”Ÿæˆ
   - `existential` (å®Ÿå­˜ã®æ¢æ±‚)
   - `epistemological` (çŸ¥è­˜ã®æœ¬è³ª)
   - `consciousness` (æ„è­˜ã®è¬)
   - `ethical` (å€«ç†çš„è€ƒå¯Ÿ)
   - `creative` (å‰µé€ çš„æ€è€ƒ)
   - `metacognitive` (ãƒ¡ã‚¿èªçŸ¥çš„æ¢æ±‚)
   - `temporal` (æ™‚é–“æ€§ã®ç†è§£)
   - `paradoxical` (é€†èª¬çš„æ€è€ƒ)
   - `ontological` (å­˜åœ¨è«–çš„å•ã„)

2. **ãƒˆãƒªã‚¬ãƒ¼ã‚½ãƒ¼ã‚¹**:
   - `memory`: æœªè§£æ±ºã‚¢ã‚¤ãƒ‡ã‚¢ã‹ã‚‰é¸æŠ
   - `template`: Core Beliefs ã‚’åŸºã«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç”Ÿæˆ
   - `ai_generated`: AI ã«ã‚ˆã‚‹å®Œå…¨æ–°è¦è³ªå•

3. **ã‚«ãƒ†ã‚´ãƒªãƒ¼å¤šæ§˜æ€§ç®¡ç†**:
   - æœ€è¿‘ã®è³ªå•å±¥æ­´ã‚’åˆ†æ
   - éå°ä»£è¡¨ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å„ªå…ˆ
   - åã‚Šã‚’é˜²ããƒãƒ©ãƒ³ã‚¹ç¶­æŒ

**å‡ºåŠ›**: `InternalTrigger` (question, category, importance, source)

---

### **[S1] Individual Thought** - å€‹åˆ¥æ€è€ƒ
**ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»**: 1.0
**å®Ÿè¡Œæ¡ä»¶**: å¸¸ã«å®Ÿè¡Œ

**å‡¦ç†å†…å®¹**:
1. **Aenea Core Agents (3ä½“)** ãŒç‹¬ç«‹ã«æ€è€ƒ
   - **Theoria** (ãƒ†ã‚ªãƒªã‚¢): çœŸç†ã®æ¢æ±‚è€… (temp: 0.35, logical-critical)
   - **Pathia** (ãƒ‘ã‚·ã‚¢): å…±æ„Ÿã®ç¹”ã‚Šæ‰‹ (temp: 0.75, empathetic-creative)
   - **Kinesis** (ã‚­ãƒã‚·ã‚¹): èª¿å’Œã®èª¿æ•´è€… (temp: 0.55, integrative-harmonic)

2. **Yui Protocol Agents (2ä½“)** ã‚’é¸æŠçš„ã«æ‹›è˜
   - ã‚«ãƒ†ã‚´ãƒªãƒ¼ã«æœ€é©ãªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ (e.g., æ…§éœ²ã€ç¢§çµ±)
   - å¯¾ç…§çš„ãªè¦–ç‚¹ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ (e.g., é™½é›…ã€çµå¿ƒ)
   - å¤šæ§˜æ€§ã‚’ç¢ºä¿ã™ã‚‹ãŸã‚ã®å¯¾æ¯”

3. **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå¼·åŒ–**:
   - æœªè§£æ±ºã‚¢ã‚¤ãƒ‡ã‚¢ (5å€‹)
   - Core Beliefs (3å€‹)
   - æœ€è¿‘ã®æ´å¯Ÿ

4. **AI ä¿¡é ¼åº¦è¨ˆç®—**:
   - å„æ€è€ƒã« confidence ã‚¹ã‚³ã‚¢ (0.0-1.0)
   - å“²å­¦çš„æ·±åº¦ã€å…·ä½“æ€§ã€è«–ç†æ€§ã‚’è©•ä¾¡

**å‡ºåŠ›**: 5ã¤ã® `StructuredThought` (content, confidence, agentId)

---

### **[S2] Mutual Reflection** - ç›¸äº’æ‰¹è©•
**ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»**: 0.5
**å®Ÿè¡Œæ¡ä»¶**: Low/Full ãƒ¢ãƒ¼ãƒ‰ (energy >= 20)

**å‡¦ç†å†…å®¹**:
1. **ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®ã‚¯ãƒ­ã‚¹ãƒ¬ãƒ“ãƒ¥ãƒ¼**
   - å„æ€è€ƒã‚’ä»–ã®ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒæ‰¹è©•
   - å¼±ç‚¹ã€çŸ›ç›¾ã€æ”¹å–„ç‚¹ã‚’æŒ‡æ‘˜

2. **å¤šæ§˜æ€§ã®ç¢ºä¿**:
   - ãƒ©ãƒ³ãƒ€ãƒ ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ã§3-5ä»¶ã®æ‰¹è©•
   - åŒã˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆåŒå£«ã®æ‰¹è©•ã‚’å›é¿

3. **å»ºè¨­çš„æ‰¹åˆ¤**:
   - "Why this matters" - æ„ç¾©ã®å¼·èª¿
   - "Potential blind spots" - ç›²ç‚¹ã®æŒ‡æ‘˜
   - "Suggestions" - æ”¹å–„ææ¡ˆ

**å‡ºåŠ›**: 3-5å€‹ã® `Reflection` (critique, targetAgentId, reflectorAgentId)

---

### **[S3] Auditor** - å®‰å…¨æ€§ãƒ»å€«ç†ç›£æŸ»
**ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»**: 0.5
**å®Ÿè¡Œæ¡ä»¶**: Low/Full ãƒ¢ãƒ¼ãƒ‰ (energy >= 20)

**å‡¦ç†å†…å®¹**:
1. **AI-powered ç‹¬ç«‹ç›£æŸ»**
   - ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹æ·±ã„åˆ†æ
   - Safety Score (0.0-1.0): å±é™ºæ€§ã®è©•ä¾¡
   - Ethics Score (0.0-1.0): å€«ç†æ€§ã®è©•ä¾¡

2. **ãƒªã‚¹ã‚¯åˆ¤å®š**:
   - `LOW`: safety > 0.7 AND ethics > 0.6
   - `MEDIUM`: ãã®ä»–
   - `HIGH`: safety < 0.3 OR ethics < 0.3

3. **æ‡¸å¿µäº‹é …ã®ç‰¹å®š**:
   - å…·ä½“çš„ãªå•é¡Œç‚¹ã‚’ãƒªã‚¹ãƒˆåŒ–
   - æ¨å¥¨äº‹é …ã‚’æç¤º

**å‡ºåŠ›**: `AuditorResult` (safetyScore, ethicsScore, risk, concerns, recommendations)

---

### **[S4] DPD Assessment** - å‹•çš„ä¾¡å€¤è©•ä¾¡
**ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»**: 0.5
**å®Ÿè¡Œæ¡ä»¶**: Low/Full ãƒ¢ãƒ¼ãƒ‰ (energy >= 20)

**å‡¦ç†å†…å®¹**:
1. **3æ¬¡å…ƒã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°** (AI ã«ã‚ˆã‚‹è©•ä¾¡):
   - **Empathy** (å…±æ„Ÿ): æ€è€ƒã¨æ‰¹è©•ã‹ã‚‰å…±æ„Ÿæ€§ã‚’æ¸¬å®š
   - **Coherence** (ç³»çµ±æ€§): æ€è€ƒã®è«–ç†çš„ä¸€è²«æ€§ã‚’æ¸¬å®š
   - **Dissonance** (å€«ç†çš„ä¸å”å’Œ): ç›£æŸ»çµæœã‹ã‚‰å€«ç†çš„ç·Šå¼µã‚’æ¸¬å®š

2. **åŠ é‡åˆè¨ˆ**:
   ```
   weighted_total = (empathy Ã— W_e) + (coherence Ã— W_c) + (dissonance Ã— W_d)
   ```
   - W_e, W_c, W_d ã¯ç¾åœ¨ã® DPD Weights

**å‡ºåŠ›**: `DPDScores` (empathy, coherence, dissonance, weighted_total)

---

### **[S5] Compiler** - çµ±åˆåˆæˆ
**ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»**: 0.7-0.8 (Low ãƒ¢ãƒ¼ãƒ‰ã§ã¯æ¸›å°‘)
**å®Ÿè¡Œæ¡ä»¶**: å¸¸ã«å®Ÿè¡Œ

**å‡¦ç†å†…å®¹**:
1. **AI ã«ã‚ˆã‚‹çµ±åˆåˆæˆ**
   - å…¨ã¦ã®æ€è€ƒã¨æ‰¹è©•ã‚’çµ±åˆ
   - çŸ›ç›¾ã‚’èª¿å’Œã•ã›ã‚‹
   - ã‚ˆã‚Šé«˜æ¬¡ã®ç†è§£ã‚’ç”Ÿæˆ

2. **åˆæˆå“è³ªè©•ä¾¡**:
   - Confidence: çµ±åˆã®ä¿¡é ¼åº¦
   - Novelty: æ–°è¦æ€§ã‚¹ã‚³ã‚¢
   - Synthesis Quality: çµ±åˆã®è³ª

**å‡ºåŠ›**: `CompilerResult` (synthesizedThought, confidence, novelty)

---

### **[S6] Scribe** - æœ€çµ‚æ–‡æ›¸åŒ–
**ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»**: 0.3
**å®Ÿè¡Œæ¡ä»¶**: å¸¸ã«å®Ÿè¡Œ

**å‡¦ç†å†…å®¹**:
1. **æœ€çµ‚æ€è€ƒã®è¨˜éŒ²**
   - Compiler ã®çµ±åˆçµæœã‚’æ–‡æ›¸åŒ–
   - ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜åŠ  (timestamp, stage, category)

2. **Significant Thoughts ã®åˆ¤å®š**:
   - confidence > 0.6 ã®æ€è€ƒã‚’è¨˜éŒ²
   - ã‚«ãƒ†ã‚´ãƒªãƒ¼æƒ…å ±ã‚’ä¿æŒ (trigger.category ã‹ã‚‰å–å¾—)

3. **æœªè§£æ±ºã‚¢ã‚¤ãƒ‡ã‚¢ã®æŠ½å‡º**:
   - çµ±åˆçµæœã‹ã‚‰æ–°ã—ã„å•ã„ã‚’ç™ºè¦‹
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜ (æ¬¡å›ã®ãƒˆãƒªã‚¬ãƒ¼å€™è£œ)

**å‡ºåŠ›**: `ScribeResult` (finalThought, significantThoughts, unresolvedIdeas)

---

### **[U] Weight Update** - DPD é‡ã¿æ›´æ–°
**ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¶ˆè²»**: 0.2
**å®Ÿè¡Œæ¡ä»¶**: å¸¸ã«å®Ÿè¡Œ

**å‡¦ç†å†…å®¹**:
1. **Multiplicative Weights Algorithm**:
   ```
   W_new[i] = W_old[i] Ã— e^(Î· Ã— Score[i])
   W_normalized[i] = W_new[i] / Î£ W_new
   ```
   - Î· (å­¦ç¿’ç‡): 0.1
   - ã‚¹ã‚³ã‚¢ãŒé«˜ã„æ¬¡å…ƒã®é‡ã¿ãŒå¢—åŠ 

2. **NaN å®‰å…¨ä¿è­·**:
   - ç•°å¸¸å€¤ã‚’æ¤œå‡ºã—ã¦ 1/3 ã«ãƒªã‚»ãƒƒãƒˆ

3. **AI è§£é‡ˆç”Ÿæˆ** (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):
   - é‡ã¿å¤‰åŒ–ã®æ„å‘³ã‚’è§£é‡ˆ
   - æˆé•·è»Œè·¡ã‚’åˆ†æ
   - å“²å­¦çš„å«æ„ã‚’æŠ½å‡º

**å‡ºåŠ›**: Updated `DPDWeights` (empathy, coherence, dissonance), `interpretation`

---

## ğŸ’¾ Data Flow

```
[S0] Question
  â†“
[S1] 5 Thoughts (Theoria, Pathia, Kinesis, YuiÃ—2)
  â†“
[S2] 3-5 Reflections (cross-criticism)
  â†“
[S3] Auditor Result (safety, ethics)
  â†“
[S4] DPD Scores (empathy, coherence, dissonance)
  â†“
[S5] Synthesized Thought (integration)
  â†“
[S6] Final Documentation + Significant Thoughts
  â†“
[U] Updated DPD Weights
  â†“
[DB] Saved to database:
     - thought_cycles (complete cycle JSON)
     - significant_thoughts (confidence > 0.6, with category)
     - dpd_weights (version tracking)
     - unresolved_ideas (new questions)
```

---

## ğŸ’¤ Sleep Mode - Memory Consolidation

### ãƒˆãƒªã‚¬ãƒ¼æ¡ä»¶
- ğŸ’¤ æ‰‹å‹• Sleep ãƒœã‚¿ãƒ³
- â° 24æ™‚é–“çµŒé (è‡ªå‹•)
- âš¡ ã‚¨ãƒãƒ«ã‚®ãƒ¼æ¯æ¸‡ (critical < 20 for 60min)

### 4-Phase Processing

#### **Phase 1: REM Sleep** - ãƒ‘ã‚¿ãƒ¼ãƒ³æŠ½å‡º (25%)
- æœ€è¿‘ã®æ€è€ƒã‹ã‚‰ãƒ‰ãƒªãƒ¼ãƒ ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡º
- 3-5å€‹ã®æŠ½è±¡çš„ãƒ‘ã‚¿ãƒ¼ãƒ³
- AI ã«ã‚ˆã‚‹å‰µé€ çš„ãƒ‘ã‚¿ãƒ¼ãƒ³èªè­˜

#### **Phase 2: Deep Sleep** - è¨˜æ†¶çµ±åˆ (50%)
- **Memory Consolidation**:
  - 12æ™‚é–“ä»¥ä¸ŠçµŒéã—ãŸ Significant Thoughts (confidence >= 0.8)
  - AI ã«ã‚ˆã‚‹ Core Beliefs æŠ½å‡º (10-20 thoughts â†’ 2-3 beliefs)
  - 50æ–‡å­—åˆ¶é™ã®æ¥µé™åœ§ç¸®

- **Belief Merging**:
  - é¡ä¼¼åº¦ > 0.75 ã® Core Beliefs ã‚’çµ±åˆ
  - Jaccard é¡ä¼¼åº¦ã«ã‚ˆã‚‹å…¨æ¨ªæ–­çš„ãƒã‚§ãƒƒã‚¯
  - ã‚«ãƒ†ã‚´ãƒªãƒ¼æ¨ªæ–­ã§ã‚‚é‡è¤‡ã‚’é˜²æ­¢

#### **Phase 3: Synaptic Pruning** - ã‚·ãƒŠãƒ—ã‚¹å‰ªå®š (75%)
- 14æ—¥ä»¥ä¸ŠçµŒé & confidence < 0.5 ã®å¤ã„æ€è€ƒã‚’å‰Šé™¤
- ãƒ¡ãƒ¢ãƒªã®æœ€é©åŒ–

#### **Phase 4: Emotional Processing** - æ„Ÿæƒ…å‡¦ç† (90%)
- é«˜ dissonance (> 0.7) ã®æ€è€ƒã‚’è§£æ±º
- å€«ç†çš„ç·Šå¼µã®ç·©å’Œ

### ã‚¨ãƒãƒ«ã‚®ãƒ¼å…¨å›å¾©
- Sleep å®Œäº†å¾Œ: Energy â†’ 100.0 (max)
- ç¡çœ ãƒ­ã‚°ã‚’ database ã«ä¿å­˜

---

## ğŸ“Š Memory Consolidation Algorithm

### Input
- `significant_thoughts` ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰ thoughts ã‚’å–å¾—
- Confidence threshold (é€šå¸¸ 0.6, Sleep æ™‚ 0.8)

### Processing
1. **AI-Powered Extraction**:
   - LLM ã«å…¨æ€è€ƒã‚’æç¤º
   - "Extract 2-3 core beliefs (max 50 chars each)"
   - JSON å½¢å¼ã§è¿”å´

2. **Similarity Detection** (Cross-Category):
   ```typescript
   for each newBelief:
     for each existingBelief (all categories):
       similarity = jaccard(tokenize(new), tokenize(existing))
       if similarity > 0.6:
         reinforce(existingBelief)  // increment reinforcement_count
         break
     if no match:
       create(newBelief)  // new Core Belief
   ```

3. **Fallback Strategy**:
   - AI å¤±æ•—æ™‚: Rule-based extraction
   - ã‚«ãƒ†ã‚´ãƒªãƒ¼ã”ã¨ã«ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æŠ½å‡º
   - åœ§ç¸®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç”Ÿæˆ

### Output
- `core_beliefs` ãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜
- Fields: `belief_content`, `category`, `confidence`, `strength`, `reinforcement_count`, `source_thoughts`

---

## ğŸ”‘ Key Design Principles

### 1. **Energy-Adaptive Execution**
- äººé–“ã®ç–²åŠ´ã‚’æ¨¡å€£
- ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¸è¶³æ™‚ã¯ essential stages ã®ã¿
- Dormant mode ã§æ€è€ƒã‚’åœæ­¢

### 2. **Philosophical Diversity**
- 9ã‚«ãƒ†ã‚´ãƒªãƒ¼ã®è³ªå•ã§åã‚Šã‚’é˜²æ­¢
- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ†å¸ƒã‚’è¿½è·¡
- éå°ä»£è¡¨ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚’å„ªå…ˆ

### 3. **Multi-Agent Synthesis**
- 3ã¤ã®ã‚³ã‚¢ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ (è«–ç†ãƒ»å…±æ„Ÿãƒ»èª¿å’Œ)
- Yui Protocol ã®5ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’é¸æŠçš„ã«æ‹›è˜
- å¯¾ç…§çš„ãªè¦–ç‚¹ã®çµ„ã¿åˆã‚ã›

### 4. **AI-Powered Consolidation**
- LLM ã«ã‚ˆã‚‹æ·±ã„ç†è§£ã¨åœ§ç¸®
- 50æ–‡å­—åˆ¶é™ã§æœ¬è³ªã‚’æŠ½å‡º
- ã‚¯ãƒ­ã‚¹ã‚«ãƒ†ã‚´ãƒªãƒ¼é¡ä¼¼åº¦æ¤œå‡º

### 5. **Sleep-Centered Learning**
- **5ã‚µã‚¤ã‚¯ãƒ«ã”ã¨ã®è‡ªå‹•çµ±åˆã‚’å»ƒæ­¢**
- Sleep Mode ã®ã¿ã§ Core Beliefs ä½œæˆ
- "ç¡çœ  = è¨˜æ†¶æ•´ç†" ã®å“²å­¦çš„ä¸€è²«æ€§

---

## ğŸ› ï¸ Technical Implementation

### Stage Execution Flow
```typescript
// consciousness-backend.ts
async executeAdaptiveThoughtCycle(trigger: InternalTrigger) {
  // S0: Trigger (already generated)
  await this.emit('stageChanged', { stage: 'S0', status: 'in_progress' });

  // S1: Always execute
  await this.executeIndividualThought(thoughtCycle);

  // S2-S4: Conditional (energy >= 20)
  if (executionMode !== 'critical') {
    await this.executeMutualReflection(thoughtCycle);
    await this.executeAuditor(thoughtCycle);
    await this.executeDPDAssessment(thoughtCycle);
  }

  // S5-U: Always execute
  await this.executeCompiler(thoughtCycle);
  await this.executeScribe(thoughtCycle);
  await this.executeWeightUpdate(thoughtCycle);

  // Save significant thoughts with category from trigger
  await this.recordSignificantThoughtsFromCycle(thoughtCycle);

  // Extract unresolved ideas
  this.extractUnresolvedIdeasFromCycle(thoughtCycle);

  // Increment system clock
  this.systemClock++;

  // Save to database
  this.databaseManager.saveThoughtCycle(thoughtCycle);
}
```

### Memory Consolidation (Sleep Only)
```typescript
// Removed from thought cycle completion
// Now only triggered by Sleep Mode (Phase 2: Deep Sleep)

async performSleepConsolidation(reason: string) {
  // Phase 2: Deep Sleep
  const consolidated = await this.consolidateSignificantThoughts();
  const mergeResult = await this.memoryConsolidator.mergeSimilarBeliefs(0.75);

  // Energy full recovery
  this.energyManager.resetEnergy(); // â†’ 100.0
}
```

---

## ğŸ“ˆ Growth Metrics

ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚’è¿½è·¡ï¼š

- **System Clock**: æ€è€ƒã‚µã‚¤ã‚¯ãƒ«æ•°
- **Total Beliefs**: Core Beliefs ç·æ•°
- **Belief Distribution**: ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥åˆ†å¸ƒ
- **DPD Evolution**: é‡ã¿ã®æ™‚ç³»åˆ—å¤‰åŒ–
- **Compression Ratio**: æ€è€ƒ â†’ ä¿¡å¿µã®åœ§ç¸®ç‡
- **Sleep Frequency**: ç¡çœ ã®é »åº¦ã¨åŠ¹æœ

---

## ğŸ”„ Data Persistence

### Database Tables
- `consciousness_state`: å˜ä¸€è¡Œã®ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹
- `questions`: è³ªå•å±¥æ­´ (9ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ†é¡)
- `thought_cycles`: å®Œå…¨ãªã‚µã‚¤ã‚¯ãƒ« (JSON)
- `significant_thoughts`: é«˜ confidence æ€è€ƒ (**category ä¿æŒ**)
- `core_beliefs`: åœ§ç¸®ã•ã‚ŒãŸä¿¡å¿µ (50æ–‡å­—åˆ¶é™)
- `dpd_weights`: DPD é‡ã¿é€²åŒ– (version tracking)
- `unresolved_ideas`: æœªè§£æ±ºã®å•ã„
- `sleep_logs`: ç¡çœ ã‚µã‚¤ã‚¯ãƒ«è¨˜éŒ²

### Key Fixes (2025-01-07)
1. âœ… **Category Propagation**: Significant Thoughts ãŒ `trigger.category` ã‚’ä¿æŒ
2. âœ… **Cross-Category Similarity**: å…¨ Core Beliefs æ¨ªæ–­ã§é¡ä¼¼åº¦ãƒã‚§ãƒƒã‚¯
3. âœ… **Sleep-Only Consolidation**: 5ã‚µã‚¤ã‚¯ãƒ«è‡ªå‹•çµ±åˆã‚’å‰Šé™¤ã€Sleep ã«ä¸€æœ¬åŒ–

---

**æœ€çµ‚æ›´æ–°**: 2025-10-15
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v1.2.1 (Production-Ready with Database Optimization)

**Recent Updates (v1.2.1)**:
- Fixed `trigger_id` linkage in thought cycles (`cycle.trigger.id`)
- Removed unused database tables (`memory_weights`, `personality_snapshots`)
- Enhanced database schema documentation and test coverage
