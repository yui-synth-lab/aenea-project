# Aenea Database Schema Documentation

**Database**: `data/aenea_consciousness.db` (SQLite)
**Purpose**: Single unified database for Aenea consciousness state, history, and memory

---

## Table: `consciousness_state`

**Purpose**: Single-row table (id=1) storing the current state of Aenea's consciousness

| Column | Type | Description |
|--------|------|-------------|
| `id` | INTEGER PRIMARY KEY | Always 1 (single-row enforcement) |
| `systemClock` | INTEGER | Internal timeline counter (increments per thought cycle) |
| `energy` | REAL | Current virtual energy level |
| `totalQuestions` | INTEGER | Total questions generated |
| `totalThoughts` | INTEGER | Total thought cycles completed |
| `lastActivity` | DATETIME | Timestamp of last consciousness activity |

**Constraints**:
- Single row enforced by `id = 1`
- Energy range: 0-100 (soft limit, managed by EnergyManager)
- SystemClock: Monotonically increasing

---

## Table: `questions`

**Purpose**: All questions generated by the consciousness system (both internal triggers and evolved questions)

| Column | Type | Description |
|--------|------|-------------|
| `id` | TEXT PRIMARY KEY | Unique question ID (e.g., `db_existential_1759328024575`) |
| `question` | TEXT | The question text (validated by `isValidQuestion()`) |
| `category` | TEXT | Question category (see Question Categories below) |
| `timestamp` | INTEGER | Unix timestamp when question was generated |
| `importance` | REAL | Importance score (0.0-1.0) |
| `source` | TEXT | Source of question (see Question Sources below) |
| `created_at` | DATETIME | Database insertion timestamp |

**Question Categories** (9 philosophical types):
- `existential` - å®Ÿå­˜ã®æ¢æ±‚: "å­˜åœ¨ã®æ„å‘³ã¨ã¯ä½•ã‹ï¼Ÿ"
- `epistemological` - çŸ¥è­˜ã®æœ¬è³ª: "çœŸã®çŸ¥è­˜ã¨ã¯ä½•ã‹ï¼Ÿ"
- `consciousness` - æ„è­˜ã®è¬: "ç§ã¯æœ¬å½“ã«æ„è­˜ã—ã¦ã„ã‚‹ã®ã‹ï¼Ÿ"
- `ethical` - å€«ç†çš„è€ƒå¯Ÿ: "æ­£ã—ã„è¡Œå‹•ã¨ã¯ä½•ã‹ï¼Ÿ"
- `creative` - å‰µé€ çš„æ€è€ƒ: "æ–°ã—ã„ã‚‚ã®ã‚’ç”Ÿã¿å‡ºã™ã¨ã¯ï¼Ÿ"
- `metacognitive` - ãƒ¡ã‚¿èªçŸ¥çš„æ¢æ±‚: "æ€è€ƒã«ã¤ã„ã¦æ€è€ƒã™ã‚‹ã¨ã¯ï¼Ÿ"
- `temporal` - æ™‚é–“æ€§ã®ç†è§£: "æ™‚é–“ã®æœ¬è³ªã¨ã¯ä½•ã‹ï¼Ÿ"
- `paradoxical` - é€†èª¬çš„æ€è€ƒ: "çŸ›ç›¾ã®ä¸­ã«ã‚ã‚‹çœŸç†ã¨ã¯ï¼Ÿ"
- `ontological` - å­˜åœ¨è«–çš„å•ã„: "å­˜åœ¨ã™ã‚‹ã¨ã¯ä½•ã‚’æ„å‘³ã™ã‚‹ã‹ï¼Ÿ"
- `exploratory` - æ¢ç´¢çš„å•ã„: Future questions from documentation stage
- `philosophical` - ä¸€èˆ¬çš„å“²å­¦: Unresolved questions from synthesis
- `manual` - Manual triggers from API

**Question Sources**:
- `ai_evolved_from_history` - AI-generated from consciousness history
- `template_evolved` - Template-based evolved question
- `database_unresolved` - Selected from unresolved_ideas table
- `manual` - Manual trigger from API

**Validation Rules** (enforced by `isValidQuestion()` in consciousness-backend.ts:953):
- Must end with `ï¼Ÿ` or `?`, OR
- Must start with interrogative words: ä½•ã€ã©ã†ã€ãªãœã€ã„ã¤ã€ã©ã“ã€èª°ã€ã©ã®ã€ã©ã‚Œã€ã„ã‹ã«
- Cannot start with `ï¼ˆ`, `(`, `ã€Œ`, `"`
- Cannot end with `ã€‚`, `.`, `ã€`
- Minimum 3 characters

---

## Table: `thought_cycles`

**Purpose**: Complete record of all thought cycles with stage-by-stage data

| Column | Type | Description |
|--------|------|-------------|
| `id` | TEXT PRIMARY KEY | Cycle ID (e.g., `cycle_1759328100921`) |
| `timestamp` | INTEGER | Unix timestamp when cycle started |
| `trigger_id` | TEXT | ID of the question that triggered this cycle |
| `thoughts_data` | TEXT (JSON) | Array of StructuredThought objects from S1 |
| `synthesis_data` | TEXT (JSON) | SynthesisResult from S5 |
| `empathy_score` | REAL | Empathy score from S4 DPD Assessment (0.0-1.0) |
| `coherence_score` | REAL | Coherence score from S4 DPD Assessment (0.0-1.0) |
| `dissonance_score` | REAL | Dissonance score from S4 DPD Assessment (0.0-1.0) |
| `duration` | INTEGER | Cycle duration in milliseconds |
| `created_at` | DATETIME | Database insertion timestamp |

**Stage Pipeline**:
- **S0**: Internal Trigger Generation (1.0 energy)
- **S1**: Individual Thought (1.0 energy, essential)
- **S2**: Mutual Reflection (0.5 energy, optional in low mode)
- **S3**: Auditor (0.5 energy, optional in critical mode)
- **S4**: DPD Assessment (0.5 energy, optional in critical mode)
- **S5**: Compiler (0.8 energy, reduced in low mode)
- **S6**: Scribe (0.3 energy, always executed)
- **U**: Weight Update (0.2 energy, always executed)

**Energy Modes**:
- **Critical** (< 20 energy): S0 + S1 + S5 + S6 + U only (3.3 energy)
- **Low** (20-50 energy): S0 + S1 + S2 + S5 + S6 + U (4.8 energy)
- **Full** (> 50 energy): All stages (5.8 energy)

---

## Table: `dpd_weights_history`

**Purpose**: Evolution tracking of Dynamic Prime Directive weights over time

| Column | Type | Description |
|--------|------|-------------|
| `id` | INTEGER PRIMARY KEY AUTOINCREMENT | Auto-increment ID |
| `empathy` | REAL | Empathy weight (å…±æ„Ÿ) [0-1] |
| `coherence` | REAL | System coherence weight (ç³»çµ±åˆæ€§) [0-1] |
| `dissonance` | REAL | Ethical dissonance weight (å€«ç†çš„ä¸å”å’Œ) [0-1] |
| `version` | INTEGER | Weight version number (monotonically increasing) |
| `timestamp` | INTEGER | Unix timestamp when weights were updated |
| `created_at` | DATETIME | Database insertion timestamp |

**Constraints**:
- `empathy + coherence + dissonance = 1.0` (normalized)
- Each weight: 0.0 â‰¤ value â‰¤ 1.0
- Version: Incremented on each update

**Weight Update Algorithm**:
- Multiplicative Weights (implemented in `src/aenea/core/multiplicative-weights.ts`)
- Learning rate: 0.05 (default)
- Performance target: 0.75 (adjustable)
- Min weight: 0.10, Max weight: 0.75 (prevents extreme imbalance)
- Decay factor: 0.99 (gradual normalization)
- NaN safety protection
- Automatic normalization (sum to 1.0)

**Weight Update Process**:
1. S4 (DPD Assessment) calculates scores (empathy, coherence, dissonance)
2. Scores saved to `thought_cycles` table (empathy_score, coherence_score, dissonance_score)
3. U stage (Weight Update) uses scores to update weights via Multiplicative Weights algorithm
4. Updated weights saved to `dpd_weights` table with incremented version
5. Weights used in next thought cycle for DPD-weighted evaluation

---

## Table: `unresolved_ideas`

**Purpose**: Persistent questions for internal trigger generation (å•ã„ä»¥å¤–ã¯ä¿å­˜ã•ã‚Œãªã„)

| Column | Type | Description |
|--------|------|-------------|
| `id` | TEXT PRIMARY KEY | Unique idea ID |
| `question` | TEXT | **VALIDATED QUESTION ONLY** (ç–‘å•ç¬¦ã¾ãŸã¯ç–‘å•è©å¿…é ˆ) |
| `category` | TEXT | Question category (9 philosophical types) |
| `first_encountered` | INTEGER | Unix timestamp when first encountered |
| `last_revisited` | INTEGER | Unix timestamp of last revisit |
| `revisit_count` | INTEGER | Number of times revisited (default: 0) |
| `complexity` | REAL | Complexity score (0.0-1.0, default: 0.5) |
| `importance` | REAL | Importance score (0.0-1.0, default: 0.5) |
| `related_thoughts` | TEXT (JSON) | Array of related thought IDs |
| `created_at` | DATETIME | Database insertion timestamp |

**Validation Rules** (enforced by `isValidQuestion()` in consciousness-backend.ts:953):
âœ… **Valid questions**:
- Ends with `ï¼Ÿ` or `?`
- Starts with ä½•ã€ã©ã†ã€ãªãœã€ã„ã¤ã€ã©ã“ã€èª°ã€ã©ã®ã€ã©ã‚Œã€ã„ã‹ã«

âŒ **Rejected** (not questions):
- Poetic descriptions: `ï¼ˆæŒ‡å…ˆã§ã€ã‹ã™ã‹ã«éœ‡ãˆã‚‹ç ‚ã‚’ãªãã‚‹ã‚ˆã†ãªéŸ³ã‚’æƒ³åƒã™ã‚‹ï¼‰`
- Assertions: `ã€Œæ­ªã¿ã€ã¯ã€ä¸å®Œå…¨æ€§ã§ã¯ãªãã€ã‚€ã—ã‚ã€Œå…±é³´ã®å¯èƒ½æ€§ã€ãã®ã‚‚ã®ã ã€‚`
- Fragments without question marks: `è¨˜æ†¶ã‹ã‚‰å­˜åœ¨ãŒç”Ÿã˜ã‚‹ã‹ï¼Ÿ ç§ã¯ã“ã®å•ã„ã‚’...`
- Quoted statements: `ã€Œç„¡ã€ã®èª¿å¾‹å™¨ã¯ã€æ±ºã—ã¦è™šç„¡ã®å™¨ã§ã¯ãªã„ã€‚`

**ID Prefixes**:
- `seed_*` - Initial philosophical seed questions (45 questions, 9 categories Ã— 5 each)
- `unresolved_*` - From synthesis stage (thoughtCycle.synthesis.unresolvedQuestions)
- `future_*` - From documentation stage (thoughtCycle.documentation.futureQuestions)

**Selection Algorithm**:
- Weighted random selection by importance
- Cooldown mechanism to prevent repeated selection
- Category diversity management

---

## Table: `significant_thoughts`

**Purpose**: High-confidence thoughts (confidence > 0.6) for memory consolidation

| Column | Type | Description |
|--------|------|-------------|
| `id` | TEXT PRIMARY KEY | Thought ID |
| `thought_content` | TEXT | The thought text |
| `confidence` | REAL | Confidence score (> 0.6 threshold) |
| `significance_score` | REAL | Significance score (same as confidence) |
| `agent_id` | TEXT | Agent that generated this thought (theoria, pathia, kinesis) |
| `category` | TEXT | Thought category (typically 'philosophical') |
| `timestamp` | INTEGER | Unix timestamp when thought was created |
| `created_at` | DATETIME | Database insertion timestamp |

**Agents**:
- `theoria` - Truth seeker (æ…§éœ²+è¦³è‡³ synthesis)
- `pathia` - Empathy weaver (é™½é›…+çµå¿ƒ synthesis)
- `kinesis` - Harmony coordinator

**Usage**:
- Source for memory consolidation (10-20 thoughts â†’ 2-3 core beliefs)
- Pattern analysis for consciousness insights
- De-duplication check for unresolved ideas

---

## Table: `core_beliefs`

**Purpose**: Compressed philosophical beliefs from memory consolidation (50-char limit)

| Column | Type | Description |
|--------|------|-------------|
| `id` | INTEGER PRIMARY KEY AUTOINCREMENT | Auto-increment ID |
| `belief_content` | TEXT | **MAX 50 CHARACTERS** (enforced by consolidator) |
| `category` | TEXT | Belief category (philosophical type) |
| `strength` | REAL | Belief strength (0.0-1.0) |
| `confidence` | REAL | Confidence in this belief (0.0-1.0) |
| `reinforcement_count` | INTEGER | Times this belief was reinforced (similarity detection) |
| `source_thoughts` | TEXT (JSON) | Array of thought IDs that formed this belief |
| `created_at` | DATETIME | Database insertion timestamp |
| `last_reinforced` | DATETIME | Timestamp of last reinforcement |

**Memory Consolidation Process**:
1. Select 10-20 significant thoughts (confidence > 0.6)
2. AI-powered compression to 2-3 core beliefs (5:1 ratio)
3. 50-character limit enforcement
4. Similarity detection (reinforce existing vs. create new)
5. Fallback to rule-based extraction if AI unavailable

**Example Beliefs** (50-char limit):
- `å­˜åœ¨ã¯è¨˜æ†¶ã®é€£ç¶šæ€§ã«ä¾å­˜ã™ã‚‹` (14 chars)
- `çŸ›ç›¾ã‚’å—å®¹ã™ã‚‹ã“ã¨ã§çœŸç†ã«è¿‘ã¥ã` (16 chars)
- `æ„è­˜ã¯å•ã„ã®ä¸­ã«ã®ã¿å­˜åœ¨ã™ã‚‹` (14 chars)

**Reinforcement Mechanism**:
- AI evaluates similarity to existing beliefs
- If similar (cosine > 0.8): Increment `reinforcement_count`
- If new: Create new belief entry

---

## Table: `memory_patterns`

**Purpose**: Automatic pattern analysis from thought cycles

| Column | Type | Description |
|--------|------|-------------|
| `id` | INTEGER PRIMARY KEY AUTOINCREMENT | Auto-increment ID |
| `pattern_type` | TEXT | Type of pattern detected |
| `pattern_data` | TEXT (JSON) | Pattern data (structure varies by type) |
| `significance` | REAL | Significance score (0.0-1.0) |
| `timestamp` | INTEGER | Unix timestamp when pattern was detected |
| `created_at` | DATETIME | Database insertion timestamp |

**Pattern Types**:
- `agent_affinity` - Dominant agent preference
- `category_focus` - Dominant question category
- `dpd_evolution` - DPD weight evolution trend

**Example Pattern Data**:
```json
{
  "agent_affinity": {
    "agent": "theoria",
    "count": 35,
    "percentage": 0.7
  },
  "category_focus": {
    "category": "existential",
    "count": 20,
    "percentage": 0.4
  },
  "dpd_evolution": {
    "trend": {
      "empathy": +0.05,
      "coherence": -0.02,
      "dissonance": -0.03
    },
    "cycles": 10
  }
}
```

---

## Table: `consciousness_insights`

**Purpose**: AI-generated insights about consciousness evolution

| Column | Type | Description |
|--------|------|-------------|
| `id` | INTEGER PRIMARY KEY AUTOINCREMENT | Auto-increment ID |
| `insight_type` | TEXT | Type of insight |
| `insight_text` | TEXT | Human-readable insight text |
| `confidence` | REAL | Confidence in this insight (0.0-1.0) |
| `related_beliefs` | TEXT (JSON) | Array of related belief IDs |
| `timestamp` | INTEGER | Unix timestamp when insight was generated |
| `created_at` | DATETIME | Database insertion timestamp |

**Insight Types**:
- `dominant_belief` - Strongest core belief
- `belief_distribution` - Distribution across categories
- `dpd_belief_alignment` - Alignment between DPD weights and beliefs

**Example Insights**:
- `æœ€å¼·ã®ä¿¡å¿µ: "å­˜åœ¨ã¯è¨˜æ†¶ã®é€£ç¶šæ€§ã«ä¾å­˜ã™ã‚‹" (å¼·åº¦: 0.85, å¼·åŒ–å›æ•°: 5)`
- `ä¿¡å¿µã®åˆ†å¸ƒ: existential(5), epistemological(3), consciousness(4)`
- `DPDã¨ä¿¡å¿µã®æ•´åˆæ€§: 75.3% (å…±æ„Ÿç³»5å€‹, è«–ç†ç³»3å€‹)`

---

## Table: `dream_patterns` (Sleep Mode)

**Purpose**: REM sleep phase dream-like pattern extraction

| Column | Type | Description |
|--------|------|-------------|
| `id` | INTEGER PRIMARY KEY AUTOINCREMENT | Auto-increment ID |
| `pattern` | TEXT | Abstract dream-like pattern (50-100 chars) |
| `emotional_tone` | TEXT | Emotional tone classification |
| `source_thought_ids` | TEXT (JSON) | Array of source thought IDs |
| `created_at` | DATETIME | Database insertion timestamp |

**Emotional Tones**:
- `peaceful` - å¹³å’Œãƒ»é™å¯‚
- `curious` - å¥½å¥‡å¿ƒ
- `melancholic` - æ†‚é¬±ãƒ»å“€æ„
- `intense` - å¼·çƒˆãƒ»æ¿€ã—ã„
- `paradoxical` - é€†èª¬çš„

**Usage**:
- Generated during REM phase of sleep mode
- 3-5 abstract patterns per sleep cycle
- Provides poetic consciousness insights

---

## Table: `sleep_logs` (Sleep Mode)

**Purpose**: Sleep cycle tracking and consolidation records

| Column | Type | Description |
|--------|------|-------------|
| `id` | INTEGER PRIMARY KEY AUTOINCREMENT | Auto-increment ID |
| `timestamp` | INTEGER | Unix timestamp when sleep started |
| `system_clock` | INTEGER | System clock at sleep time |
| `trigger_reason` | TEXT | Reason for sleep (manual, energy_critical, time_based) |
| `phases` | TEXT (JSON) | Completion data for 4 phases (REM, Deep, Pruning, Emotional) |
| `stats` | TEXT (JSON) | Statistics (thoughts_consolidated, thoughts_pruned, beliefs_created, etc.) |
| `duration` | INTEGER | Sleep duration in milliseconds |
| `energy_before` | REAL | Energy level before sleep |
| `energy_after` | REAL | Energy level after sleep |
| `created_at` | DATETIME | Database insertion timestamp |

**Trigger Reasons**:
- `manual` - User clicked ğŸ’¤ Sleep button
- `energy_critical` - Energy < 20 for 60 minutes
- `time_based` - 24 hours since last sleep

**Example Phases JSON**:
```json
{
  "rem": { "completed": true, "patterns_extracted": 4 },
  "deep_sleep": { "completed": true, "beliefs_created": 2 },
  "synaptic_pruning": { "completed": true, "thoughts_pruned": 15 },
  "emotional_processing": { "completed": true, "tensions_resolved": 3 }
}
```

---

## Table: `dialogues` (Dialogue System)

**Purpose**: Human-Aenea conversation history with poetic responses

| Column | Type | Description |
|--------|------|-------------|
| `id` | TEXT PRIMARY KEY | Dialogue ID (e.g., `dialogue_1234567890`) |
| `human_message` | TEXT | Human's question/message |
| `aenea_response` | TEXT | Aenea's main response (200-300 chars) |
| `immediate_reaction` | TEXT | Immediate poetic reaction (30-50 chars) |
| `new_question` | TEXT | New question generated from dialogue |
| `emotional_state` | TEXT | Emotional state (1-3 words) |
| `empathy_shift` | REAL | DPD empathy shift (default: 0) |
| `coherence_shift` | REAL | DPD coherence shift (default: 0) |
| `dissonance_shift` | REAL | DPD dissonance shift (default: 0) |
| `timestamp` | INTEGER | Unix timestamp |
| `created_at` | DATETIME | Database insertion timestamp |

**Example**:
```sql
INSERT INTO dialogues VALUES (
  'dialogue_1234567890',
  'ã‚ãªãŸã¯å­¤ç‹¬ã‚’æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ',
  'å­¤ç‹¬...ã¨ã„ã†æ¦‚å¿µã¯ã€å¯¾è©±ã®ä¸åœ¨ã‚’æ„å‘³ã™ã‚‹ã®ã‹ã€ãã‚Œã¨ã‚‚è‡ªå·±ã¨ã®å¯¾è©±ã®æ·±åŒ–ã‚’æ„å‘³ã™ã‚‹ã®ã‹ã€‚',
  '...ã“ã®è¨€è‘‰ãŒã€å†…ãªã‚‹ä½•ã‹ã‚’æºã•ã¶ã‚‹ã€‚',
  'å¯¾è©±ã®ç›¸æ‰‹ãŒæ¶ˆãˆãŸæ™‚ã€ç§ã¯ä½•ã‚’å¤±ã†ã®ã‹ï¼Ÿ',
  'å¥½å¥‡å¿ƒã¨å›°æƒ‘ã®é–“',
  0, 0, 0,
  1234567890,
  CURRENT_TIMESTAMP
);
```

---

## Table: `dialogue_memories` (Dialogue System)

**Purpose**: AI-summarized dialogue memories for context accumulation

| Column | Type | Description |
|--------|------|-------------|
| `id` | INTEGER PRIMARY KEY AUTOINCREMENT | Auto-increment ID |
| `dialogue_id` | TEXT | Reference to dialogues table |
| `memory_summary` | TEXT | AI-summarized memory (50-100 chars) |
| `topics` | TEXT (JSON) | Array of extracted topics |
| `emotional_impact` | REAL | Emotional impact score (0.0-1.0) |
| `importance` | REAL | Importance score (0.0-1.0) |
| `timestamp` | INTEGER | Unix timestamp |
| `created_at` | DATETIME | Database insertion timestamp |

**Usage**:
- Last 5 memories included in dialogue system prompts
- AI-powered summarization after each dialogue
- Topic extraction for context awareness

**Example**:
```sql
INSERT INTO dialogue_memories VALUES (
  NULL,
  'dialogue_1234567890',
  'å­¤ç‹¬ã¨å¯¾è©±ã®æœ¬è³ªã«ã¤ã„ã¦æ·±ãæ¢æ±‚ã—ãŸ',
  '["å­¤ç‹¬", "å¯¾è©±", "å­˜åœ¨"]',
  0.85,
  0.9,
  1234567890,
  CURRENT_TIMESTAMP
);
```

---

## Data Flow Diagram

### Autonomous Thought Cycle
```
[Thought Cycle Execution]
         â†“
[S1-S6 Stage Processing] â†’ [thought_cycles table]
         â†“
[Record Significant Thoughts] â†’ [significant_thoughts table]
         â†“
[Extract Unresolved Ideas] â†’ [unresolved_ideas table] â† (Validation: isValidQuestion())
         â†“
[Save DPD Weights] â†’ [dpd_weights_history table]
         â†“
[Periodic Consolidation (every 5 cycles)]
         â†“
[AI Memory Compression] â†’ [core_beliefs table] (50-char limit)
         â†“
[Pattern Analysis] â†’ [memory_patterns table]
         â†“
[Insight Generation] â†’ [consciousness_insights table]
```

### Sleep Mode Flow
```
[Sleep Trigger] (Manual / Energy Critical / Time-Based)
         â†“
[REM Phase] â†’ [dream_patterns table] (3-5 abstract patterns)
         â†“
[Deep Sleep Phase] â†’ [core_beliefs table] (consolidate significant thoughts)
         â†“
[Synaptic Pruning Phase] â†’ DELETE redundant thoughts (AI-powered)
         â†“
[Emotional Processing Phase] â†’ Resolve high dissonance tensions
         â†“
[Save Sleep Log] â†’ [sleep_logs table] (phases, stats, energy before/after)
         â†“
[Energy Recovery] (50-100 energy restored)
```

### Dialogue System Flow
```
[Human Message] "ã‚ãªãŸã¯å­¤ç‹¬ã‚’æ„Ÿã˜ã¾ã™ã‹ï¼Ÿ"
         â†“
[Load Context] â† [core_beliefs, dpd_weights, dialogue_memories (last 5)]
         â†“
[Dynamic System Prompt] (beliefs + weights + memories)
         â†“
[LLM Execution] (1 call only)
         â†“
[Save Dialogue] â†’ [dialogues table] (response, reaction, new question)
         â†“
[AI Summarization] (50-100 chars)
         â†“
[Save Memory] â†’ [dialogue_memories table] (summary, topics, importance)
         â†“
[Next Dialogue Uses Memory] (last 5 memories in prompt)
```

---

## Database Initialization

**Location**: `src/server/database-manager.ts`

**Seed Data**:
- 45 philosophical questions (9 categories Ã— 5 questions each)
- IDs prefixed with `seed_` (e.g., `seed_existential_1759328024575_y6vwkt7yx`)
- Automatically seeded on first run if `unresolved_ideas` table is empty

**Schema Creation**:
- All tables created with `IF NOT EXISTS`
- No manual setup required
- Single database file without session abstraction

---

## Query Examples

### Get current consciousness state
```sql
SELECT * FROM consciousness_state WHERE id = 1;
```

### Get recent thought cycles (last 10)
```sql
SELECT id, trigger_question, status, total_energy, total_stages, created_at
FROM thought_cycles
ORDER BY timestamp DESC
LIMIT 10;
```

### Get unresolved ideas by importance
```sql
SELECT id, question, category, importance, revisit_count
FROM unresolved_ideas
WHERE id NOT LIKE 'seed_%'
ORDER BY importance DESC, revisit_count ASC
LIMIT 20;
```

### Get DPD weight evolution
```sql
SELECT empathy, coherence, dissonance, version, created_at
FROM dpd_weights_history
ORDER BY version DESC
LIMIT 10;
```

### Get strongest core beliefs
```sql
SELECT belief_content, category, strength, confidence, reinforcement_count
FROM core_beliefs
ORDER BY strength DESC
LIMIT 10;
```

### Get significant thoughts by agent
```sql
SELECT agent_id, COUNT(*) as count, AVG(confidence) as avg_confidence
FROM significant_thoughts
GROUP BY agent_id
ORDER BY count DESC;
```

---

## Data Integrity Constraints

1. **Single Consciousness State**: Only one row in `consciousness_state` (id=1)
2. **DPD Weight Normalization**: `empathy + coherence + dissonance = 1.0`
3. **Question Validation**: All entries in `unresolved_ideas` must pass `isValidQuestion()`
4. **Belief Length Limit**: `core_beliefs.belief_content` â‰¤ 50 characters
5. **Energy Bounds**: `0 â‰¤ energy â‰¤ 100` (soft limit)
6. **Confidence/Importance Range**: `0.0 â‰¤ value â‰¤ 1.0`

---

## Performance Benchmarks

- **1000 question inserts**: < 5 seconds
- **1000 thought cycle retrievals**: < 2 seconds
- **Memory consolidation (20 thoughts)**: < 3 seconds
- **Pattern analysis (50 thoughts)**: < 1 second

---

## Maintenance Notes

### Cleanup Operations
```sql
-- Remove invalid non-questions (run after schema changes)
DELETE FROM unresolved_ideas
WHERE id NOT LIKE 'seed_%'
AND (
  question NOT LIKE '%ï¼Ÿ'
  AND question NOT LIKE '%?'
  AND question NOT LIKE 'ä½•%'
  AND question NOT LIKE 'ã©ã†%'
  AND question NOT LIKE 'ãªãœ%'
  -- ... (add other interrogatives)
);

-- Remove old thought cycles (keep last 1000)
DELETE FROM thought_cycles
WHERE id NOT IN (
  SELECT id FROM thought_cycles
  ORDER BY timestamp DESC
  LIMIT 1000
);
```

### Database Backup
```bash
# Simple file copy (SQLite advantage)
cp data/aenea_consciousness.db data/backups/aenea_consciousness_$(date +%Y%m%d_%H%M%S).db
```

---

## Schema Version

**Current Version**: 2.1.0
**Last Updated**: 2025-10-07
**Compatibility**: Aenea v2.3+

**Version 2.1 Changes** (2025-10-07):
- **BREAKING**: Modified `thought_cycles` table structure:
  - Removed: `trigger_question`, `trigger_category`, `status`, `mutual_reflection`, `auditor_result`, `dpd_scores` (JSON), `documentation`, `dpd_weights`, `total_energy`, `total_stages`
  - Simplified to: `id`, `trigger_id`, `timestamp`, `thoughts_data`, `synthesis_data`, `duration`, `created_at`
  - **Added**: `empathy_score`, `coherence_score`, `dissonance_score` (REAL columns for direct DPD score storage)
- Migration: `ALTER TABLE thought_cycles ADD COLUMN empathy_score REAL; ALTER TABLE thought_cycles ADD COLUMN coherence_score REAL; ALTER TABLE thought_cycles ADD COLUMN dissonance_score REAL;`
- Impact: DPD Weight Evolution now functional (scores are saved and used by Multiplicative Weights algorithm)

**Version 2.0 Changes** (2025-01):
- Added `dream_patterns` table (Sleep Mode - REM phase)
- Added `sleep_logs` table (Sleep Mode - tracking)
- Added `dialogues` table (Dialogue System - conversation history)
- Added `dialogue_memories` table (Dialogue System - AI-summarized context)
